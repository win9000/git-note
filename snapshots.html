<!doctype html>

<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <link href="style.css" rel="stylesheet">
        <title>关于快照的解释</title>
    </head>
    <body>
    <div class="page-wrapper">
        <h1>都在说快照，但快照到底是什么？</h1>

        <ol>
            <li>什么是快照？用来做什么？</li>
            <p >快照是特定数据集的一个完整可用的拷贝，该数据集包含源数据在拷贝点的静态映象，它可以是数据再现
                的一个副本或者复制.说起来有些文绉绉的不好理解，那么这究竟是什么意思？通俗地讲，咱们可以把快
                照理解成拍照。
                譬如说，在某一时刻用手机给你拍了一张照片，那么照片中的你的状态就定格在了拍照的那一瞬间。
                当明天的你再来看这张照片的时候，你就能看到拍照时你的状态是如何的，这就是简单意义上的快照。
                那么，快照的实际应用场景是哪些呢？前面其实有说到，快照是备份技术的一种，一旦原来的数据发
                生了变化（可能因为某些原因数据发生了丢失等等），使用快照就可以恢复原来的数据。
                比如在电商网站购物发生了纠纷要申请售后，但是点开原来的产品链接时，发生产品描述发生了变化，
                怎么办？这时候，就可以点击产品快照，查询购买时的产品描述信息，恢复原有信息。那这样的话数
                据的可靠性和可用性是不是有了一个质的飞跃呢？常见的快照技术有很多种，有全拷贝快照、差分快照
                等等，我们主要讲解差分快照里面的COW以及ROW快照。</p>

            <li>COW快照的工作原理</li>
            <p>COW（Copy On Write），全称是写前拷贝。当一个新的写操作执行时，首先读出写操作将要覆盖地
                址的当前数据，将读出数据保存在专用空间并建立索引，然后再执行新的写操作（写入目标地址）。
                结合图示我们来理解一下：</p>
            <img src="images/v2-b07bb6055e5361d554de4e54393d87a3_720w.jpg" >
            <p><strong>创建快照前：</strong>在磁盘未进行任何快照前，数据写入动作与其他磁盘一样，对数据进行修改，会直接写入
                原有磁盘数据块对原有数据进行覆盖，原有数据不会被保留。</p>
            <p><strong>创建快照：</strong>快照创建后，会生成与源磁盘一致的数据副本。此时，后端存储系统在源磁盘所在的存储池
                中动态划分COW数据空间并自动生成快照，快照的指针指向源磁盘数据的存储位置。</p>
            <p><strong>源磁盘写入数据：</strong>当实例对源磁盘有数据写入请求时，后端存储系统不会立即写入新数据。后端存储系
                统利用写前拷贝机制先将写前拷贝数据拷贝到COW数据空间中，并修改映射表中的映射关系，然后将新数据写入源磁盘。</p>
            <p>修改源磁盘中的数据A前，需要先将数据A拷贝至COW数据空间，然后修改快照指针指向COW数据空间中数据A的存储位置，
                最后才将数据A'写入源磁盘。</p>
            <p>那么如何恢复原来的数据ABC呢？只需要将COW快照空间回滚源磁盘（将COW快照空间的数据盖到源磁盘上即可），此时的数据
                就是原来的数据ABC。</p>
            
            <li>ROW快照的工作原理</li>
            <p>ROW（Redirect On Write），全称是写时重定向。读写操作步骤：到源卷的新的写数据被存入日志（并索引），读源卷时，
                先检索日志，读快照时，源卷需要引用。当快照取消时，写日志必须全部执行以与源卷保证数据状态同步更新。同样的，也结
                合图示一起来看一下：</p>
                <img src="images/v2-9c87a4957f52b1c320ae41ee005a1df5_720w.jpg" >
                <p><strong>创建快照前：</strong>在磁盘未进行任何快照前，数据写入动作与其他磁盘一样，对数据进行修改，会直接
                    写入原有磁盘数据块对原有数据进行覆盖，原有数据不会被保留。</p>
                <p><strong>创建快照：</strong>快照创建后，会生成与源磁盘一致的数据副本。此时，后端存储系统将源磁盘的指针复
                    制给快照，快照的指针指向源磁盘数据的存储位置。</p>
                <p><strong>源磁盘写入数据：</strong>快照创建后，当实例对源磁盘有数据写入请求时，存储系统利用ROW技术将新写
                    入的数据存放在新的位置，源磁盘的指针更新，指向新数据的存放位置。快照的指针仍指向原始数据的存储位置，从而
                    保存源磁盘在快照创建时间点的数据。</p>
                <p>修改源磁盘中的数据A时，会将新数据A'写入新的位置，然后修改源磁盘的指针指向A'的存储位置。快照的指针仍指向原
                    始数据A的存储位置。现阶段的数据即为A’BC，源磁盘的数据不变，为ABC。</p>
        </ol>
        <div class="footer">--end--</div>
        
    </div>

        

    </body>
</html>